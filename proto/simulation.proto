syntax = "proto3";

option go_package = "contest-influence/proto/simulation;simulation";

// position at map
message Position {
    uint32 row = 1;
    uint32 col = 2;
}

// single cell of a map
message Cell {
    Position pos = 1;
    uint32 value = 2;
}

// array of cells
message Cells {
    repeated Cell cells = 1;
}

// map, consisting of cells
message Map {
    int32 nrows = 2;
    int32 ncols = 3;

    // matrix of size nrows * ncols. true - usable cell, false - unusable
    repeated bool field_mask = 4;
    // sparse: only placement
    repeated Position big_cells = 5;

    repeated Position start_positions = 6;
}

//state of simulation
message SimulationSate {
    Map map = 3;
    map<int64, Cells> influence = 4;
}

// attack turn
message Attack {
    Position from = 1;
    Position to = 2;
}

// result of attack
message AttackResult {
    Cell from = 1;
    Cell to = 2;
    bool win = 3;
}

// attack simulation phase
message AttackSimulationPhase {
    // position of attacking and attacked cells
    repeated AttackResult results = 2;
}

// defense turn is cell
// defense result is cell

// defense simulation phase
message DefenseSimulationPhase {
    // position of defending cell and values is a points number, skipped if autodefense is true
    Cells moves = 2;
}

// statistics of 1 player
message PlayerStatistics {
  int64 score = 1;
  // any other statistics
}

// statistics of all players for simulation round
message Statistics {
  map<int64, PlayerStatistics> players = 1;
}

// round of simulation
message Round {
    AttackSimulationPhase attack = 1;
    DefenseSimulationPhase defense = 2;
}

// simulation
message Simulation {
    // sequential rounds of all players in order of player_ids
    repeated Round rounds = 3;
    // statistics of all players after each round and at the begining of the simulation.
    // Indexed in same order as rounds field. First values are statistics before first round
    // If in a round no statistics where provided for player or some stats missing in statistics for player
    // then they have previous values for that round. 
    // So if showing of null value of statistic is needed, so it is needed to use special values for that
    repeated Statistics statistics = 4;
}
